output: default
groups: {}
asyncFuncTimeout: 1000
functions:
  - id: comment
    filter: "true"
    disabled: false
    conf:
      comment: >-
        Calix AXOS Category Enrichment Pipeline - For LOCAL0-LOCAL5 facility
        categories (SECURITY, ARC, CONFIGURATION, DBCHANGE, GENERAL, ERPS).
        Extracts AXOS bracket fields and message code, enriches with facility
        category lookup, and sets dynamic sourcetype based on category.

  - id: regex_extract
    filter: "true"
    disabled: false
    conf:
      source: _raw
      iterations: 1
      overwrite: false
      type: regex
      regex: /\[(?<shelf_id>\d+)\]\[(?<slot_id>\d+)\]\[(?<controller_state>[AS])\]\[(?<process_id>\d+)\]\s+\[\d+\]/

  - id: regex_extract
    filter: "true"
    disabled: false
    conf:
      source: _raw
      iterations: 1
      overwrite: false
      type: regex
      regex: /(?<message_code>\w+\.\w+\.\d+):\s+(?<message_body>.*)/

  - id: lookup
    filter: "true"
    disabled: false
    conf:
      file: calix_facility_map.csv
      matchMode: exact
      matchType: first
      reloadPeriodSec: 60
      addToEvent: false
      inFields:
        - eventField: facility
          lookupField: priority
      outFields:
        - lookupField: axos_category
          eventField: axos_category
        - lookupField: description
          eventField: facility_description

  - id: eval
    filter: "C.vars['remove_intermediate_fields'] !== false"
    disabled: false
    conf:
      remove:
        - facility_description

  - id: eval
    filter: "true"
    disabled: false
    conf:
      add:
        - disabled: false
          name: sourcetype
          value: "'calix:axos:' + (axos_category || 'generic').toLowerCase()"

  - id: eval
    filter: "true"
    disabled: false
    conf:
      add:
        - disabled: false
          name: security_alert
          value: "axos_category === 'SECURITY'"

  - id: eval
    filter: "C.vars['raw_handling'] === 'truncate'"
    disabled: false
    conf:
      add:
        - disabled: false
          name: _raw
          value: "_raw.substring(0, 256)"

  - id: eval
    filter: "C.vars['raw_handling'] === 'remove'"
    disabled: false
    conf:
      remove:
        - _raw
description: >-
  Calix AXOS category enrichment pipeline for LOCAL0-LOCAL5 facilities.
  Extracts bracket fields and message code, enriches with facility category
  from lookup, sets dynamic sourcetype (calix:axos:<category>), and flags
  SECURITY category events.
